<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
</head>

<body>
<div th:fragment="recommendation" class="max-w-4xl mx-auto">
    <div class="text-center mb-12">
        <span class="badge mb-4" th:text="#{recommendations.badge}">What Others Say</span>
        <h2 id="recommendations-heading" class="section-title" th:text="#{recommendations.title}">Recommendations</h2>
        <p class="section-description" th:text="#{recommendations.description}">
            Kind words from colleagues and managers I've had the privilege to work with.
        </p>
    </div>

    <div class="relative" 
         th:attr="x-data=${'{ active: 0, total: ' + details.recommendations().size() + ', next() { this.active = (this.active + 1) % this.total }, prev() { this.active = (this.active - 1 + this.total) % this.total } }'}"
         @keydown.left.prevent="prev()"
         @keydown.right.prevent="next()"
         role="region"
         aria-roledescription="carousel"
         th:aria-label="#{recommendations.title}">
        
        <div class="relative grid" aria-live="polite">
            <article th:each="rec, iterStat : ${details.recommendations()}"
                     class="recommendation-card"
                     th:attr="data-index=${iterStat.index}"
                     x-bind:class="active === parseInt($el.dataset.index) ? 'recommendation-active' : ''"
                     x-bind:aria-hidden="active !== parseInt($el.dataset.index)"
                     x-bind:tabindex="active === parseInt($el.dataset.index) ? 0 : -1">
                <div class="quote-icon">
                    <svg class="w-full h-full" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/>
                    </svg>
                </div>
                <blockquote class="quote-text" th:text="${rec.quote()}"></blockquote>
                <div class="recommendation-footer">
                    <div class="flex items-center gap-3">
                        <div class="avatar-initials" th:text="${rec.authorInitials()}"></div>
                        <div>
                            <p class="author-name" th:text="${rec.authorName()}"></p>
                            <p class="author-role" th:text="${rec.authorRole()}"></p>
                        </div>
                    </div>
                    <a th:href="${rec.letterPdf()}" target="_blank" rel="noopener noreferrer" class="btn-accent-subtle"
                       x-bind:tabindex="active === parseInt($el.closest('article').dataset.index) ? 0 : -1">
                        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
                        </svg>
                        <span th:text="#{recommendations.view.letter}">View Letter</span>
                    </a>
                </div>
            </article>
        </div>

        <div class="flex items-center justify-center gap-4 mt-8">
            <button type="button" class="carousel-nav-btn" x-on:click="prev()" th:attr="aria-label=#{recommendations.prev}">
                <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
                </svg>
            </button>
            
            <div class="flex items-center gap-2">
                <button th:each="rec, iterStat : ${details.recommendations()}"
                        type="button" class="recommendation-dot"
                        th:attr="data-index=${iterStat.index},aria-label=#{recommendations.goto(${iterStat.count})}"
                        x-bind:class="active === parseInt($el.dataset.index) ? 'active' : ''"
                        x-on:click="active = parseInt($el.dataset.index)">
                </button>
            </div>
            
            <button type="button" class="carousel-nav-btn" x-on:click="next()" th:attr="aria-label=#{recommendations.next}">
                <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
                </svg>
            </button>
        </div>
    </div>
</div>
</body>

</html>
